<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ì†Œë§4 ëª©ì¥ ì¶œì„ë¶€</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%); min-height: 100vh; color: #333; }
        .welcome-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 600; color: #fff; padding: 20px; }
        .welcome-screen.hidden { display: none; }
        .welcome-icon { font-size: 80px; margin-bottom: 30px; }
        .welcome-title { font-size: 24px; font-weight: 700; margin-bottom: 10px; text-align: center; }
        .welcome-subtitle { font-size: 16px; opacity: 0.9; margin-bottom: 50px; text-align: center; }
        .welcome-btn { background: #fff; color: #667eea; border: none; padding: 18px 40px; border-radius: 30px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .welcome-btn:active { transform: scale(0.95); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px 16px; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); color: #fff; }
        .home-btn, .help-btn { position: absolute; top: 18px; width: 36px; height: 36px; background: rgba(255,255,255,0.2); border: none; border-radius: 50%; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .home-btn { left: 16px; }
        .help-btn { right: 16px; }
        .header h1 { font-size: 22px; font-weight: 700; text-align: center; margin-bottom: 16px; }
        .sync-status { text-align: center; font-size: 12px; margin-bottom: 12px; opacity: 0.9; }
        .sync-status.syncing { color: #fef08a; }
        .sync-status.synced { color: #bbf7d0; }
        .sync-status.error { color: #fecaca; }
        .date-selector { display: flex; align-items: center; justify-content: center; gap: 12px; }
        .date-selector button { background: rgba(255,255,255,0.25); border: none; color: #fff; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; }
        .current-date { font-size: 18px; font-weight: 600; min-width: 120px; text-align: center; }
        .stats-bar { display: flex; justify-content: center; gap: 20px; margin-top: 12px; font-size: 14px; }
        .stat { display: flex; align-items: center; gap: 6px; }
        .stat-dot { width: 10px; height: 10px; border-radius: 50%; }
        .stat-dot.present { background: #4ade80; }
        .stat-dot.absent { background: #f87171; }
        .container { padding: 16px; padding-bottom: 100px; }
        .calendar-section { background: #fff; border-radius: 16px; padding: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        .calendar-title { font-size: 18px; font-weight: 700; color: #374151; margin-bottom: 16px; text-align: center; }
        .calendar-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .mini-calendar { background: #f9fafb; border-radius: 12px; padding: 10px; }
        .mini-calendar-header { font-size: 14px; font-weight: 700; color: #667eea; text-align: center; margin-bottom: 8px; }
        .mini-calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; font-size: 10px; text-align: center; }
        .mini-calendar-days .day-header { color: #9ca3af; font-weight: 600; padding: 2px 0; }
        .mini-calendar-days .day-header:first-child { color: #ef4444; }
        .mini-calendar-days .day-header:last-child { color: #3b82f6; }
        .mini-calendar-days .day { padding: 3px 0; color: #374151; position: relative; }
        .mini-calendar-days .day.empty { color: transparent; }
        .mini-calendar-days .day.sunday { color: #ef4444; }
        .mini-calendar-days .day.saturday { color: #3b82f6; }
        .holiday-dot { position: absolute; top: 1px; right: 1px; width: 4px; height: 4px; background: #ef4444; border-radius: 50%; }
        .prayer-summary { background: #fff; border-radius: 16px; margin-bottom: 16px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        .prayer-summary-header { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #fff; padding: 12px 16px; font-weight: 700; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
        .prayer-summary-toggle { background: rgba(255,255,255,0.2); border: none; color: #fff; padding: 4px 10px; border-radius: 12px; font-size: 12px; cursor: pointer; }
        .prayer-summary-content { padding: 12px 16px; max-height: 300px; overflow-y: auto; }
        .prayer-summary-content.collapsed { display: none; }
        .prayer-summary-item { padding: 10px 0; border-bottom: 1px solid #f3f4f6; }
        .prayer-summary-item:last-child { border-bottom: none; }
        .prayer-summary-family { font-size: 13px; font-weight: 600; color: #d97706; margin-bottom: 4px; }
        .prayer-summary-text { font-size: 14px; color: #374151; line-height: 1.5; }
        .prayer-summary-empty { color: #9ca3af; font-size: 14px; text-align: center; padding: 20px; }
        .role-section { background: #fff; border-radius: 16px; margin-bottom: 16px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        .role-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 12px 16px; font-weight: 700; font-size: 14px; }
        .members-list { padding: 8px 0; }
        .couple-group { border-bottom: 1px solid #c7d2fe; padding-bottom: 4px; margin-bottom: 4px; }
        .couple-group:last-child { border-bottom: none; }
        .member-row { display: flex; align-items: center; padding: 14px 16px; }
        .member-name { flex: 1; font-size: 16px; color: #374151; }
        .children-info { font-size: 12px; color: #9ca3af; padding: 0 16px 8px; }
        .attendance-toggle { display: flex; gap: 8px; }
        .toggle-btn { width: 44px; height: 44px; border-radius: 12px; border: 2px solid #e5e7eb; background: #fff; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .toggle-btn.present { background: #dcfce7; border-color: #4ade80; color: #16a34a; }
        .toggle-btn.absent { background: #fee2e2; border-color: #f87171; color: #dc2626; }
        .prayer-section { padding: 8px 16px 12px; background: #f8fafc; }
        .prayer-input-wrap { display: flex; gap: 8px; align-items: center; }
        .prayer-input { flex: 1; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: #fff; }
        .prayer-input:focus { outline: none; border-color: #667eea; }
        .prayer-save-btn { padding: 10px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; }
        .prayer-label { font-size: 12px; color: #9ca3af; margin-bottom: 4px; }
        .saved-prayer { margin-top: 8px; padding: 10px 12px; background: #f0fdf4; border-radius: 8px; border-left: 3px solid #4ade80; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
        .saved-prayer-text { font-size: 14px; color: #166534; flex: 1; }
        .saved-prayer-actions { display: flex; gap: 4px; }
        .prayer-edit-btn { padding: 4px 8px; background: #e0e7ff; color: #4338ca; border: none; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer; }
        .prayer-delete-btn { padding: 4px 8px; background: #fee2e2; color: #dc2626; border: none; border-radius: 4px; font-size: 11px; font-weight: 600; cursor: pointer; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; padding: 12px 16px; padding-bottom: max(12px, env(safe-area-inset-bottom)); display: flex; gap: 8px; box-shadow: 0 -4px 20px rgba(0,0,0,0.1); z-index: 100; }
        .nav-btn { flex: 1; padding: 14px 8px; border: none; border-radius: 12px; font-size: 11px; font-weight: 600; cursor: pointer; }
        .nav-btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
        .nav-btn.secondary { background: #f3f4f6; color: #374151; }
        .nav-btn.copy { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: #fff; }
        .nav-btn.prayer { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: #fff; }
        .nav-btn.manage { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: #fff; }
        .date-picker-modal, .manage-modal, .password-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 500; padding: 20px; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .date-picker-modal.show, .manage-modal.show, .password-modal.show { opacity: 1; visibility: visible; }
        .password-modal { z-index: 600; }
        .date-picker-content, .manage-content, .password-content { background: #fff; border-radius: 20px; padding: 20px; width: 100%; max-width: 360px; max-height: 80vh; overflow-y: auto; position: relative; }
        .close-x { position: absolute; top: 16px; right: 16px; width: 32px; height: 32px; background: #f3f4f6; border: none; border-radius: 50%; font-size: 18px; color: #374151; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .date-picker-title, .manage-title, .password-title { font-size: 18px; font-weight: 700; text-align: center; margin-bottom: 16px; color: #374151; }
        .date-grid { display: flex; flex-direction: column; gap: 16px; }
        .month-section { background: #f9fafb; border-radius: 12px; padding: 12px; }
        .month-header { font-size: 16px; font-weight: 700; color: #667eea; margin-bottom: 10px; padding-left: 4px; }
        .month-dates { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; }
        .date-item { padding: 10px 6px; background: #fff; border-radius: 10px; text-align: center; font-size: 14px; cursor: pointer; color: #374151; position: relative; border: 1px solid #e5e7eb; }
        .date-item:active, .date-item.selected { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border-color: transparent; }
        .date-item.has-data { background: #dcfce7; border: 2px solid #4ade80; }
        .date-item .week { font-size: 11px; opacity: 0.7; }
        .date-item .day { font-size: 14px; font-weight: 700; }
        .date-item .check-mark { position: absolute; top: 2px; right: 4px; font-size: 10px; color: #16a34a; }
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .loading-overlay.hidden { display: none; }
        .loading-spinner { width: 40px; height: 40px; border: 4px solid #e5e7eb; border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 16px; color: #6b7280; font-size: 14px; }
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #1f2937; color: #fff; padding: 12px 24px; border-radius: 8px; font-size: 14px; z-index: 1000; opacity: 0; transition: opacity 0.3s; }
        .toast.show { opacity: 1; }
        .manage-section { margin-bottom: 20px; }
        .manage-section-title { font-size: 14px; font-weight: 600; color: #667eea; margin-bottom: 10px; }
        .manage-input, .manage-select { width: 100%; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; margin-bottom: 8px; background: #fff; }
        .manage-btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; margin-bottom: 8px; }
        .manage-btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
        .manage-btn.danger { background: #fee2e2; color: #dc2626; }
        .manage-btn.secondary { background: #f3f4f6; color: #374151; }
        .couple-list { max-height: 200px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; }
        .couple-item { padding: 12px; border-bottom: 1px solid #e5e7eb; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .couple-item:last-child { border-bottom: none; }
        .couple-item.selected { background: #e0e7ff; }
        .couple-item-name { font-size: 14px; color: #374151; }
        .couple-item-role { font-size: 12px; color: #9ca3af; }
        .password-input { width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px; text-align: center; margin-bottom: 12px; }
        .password-hint { color: #6b7280; font-size: 13px; margin-bottom: 12px; text-align: center; }
        .password-error { color: #dc2626; font-size: 13px; margin-bottom: 12px; display: none; text-align: center; }
        .password-error.show { display: block; }
    </style>
</head>
<body>
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-icon">â›ª</div>
        <div class="welcome-title">ë™ì•ˆêµíšŒ ì‹ í˜¼2ë§ˆì„</div>
        <div class="welcome-subtitle">ì¶œì„ë¶€</div>
        <button class="welcome-btn" onclick="startApp()">í• ë ë£¨ì•¼ ì†Œë§4 ëª©ì¥ ì…ë‹ˆë‹¤</button>
    </div>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
    <div class="header">
        <button class="home-btn" onclick="goHome()">ğŸ </button>
        <button class="help-btn" onclick="location.href='help.html'">â“</button>
        <h1>â›ª ë™ì•ˆêµíšŒ ì†Œë§4 ëª©ì¥ ì¶œì„ë¶€</h1>
        <div class="sync-status" id="syncStatus">ì—°ê²° ì¤‘...</div>
        <div class="date-selector">
            <button onclick="changeDate(-1)">â€¹</button>
            <span class="current-date">2/1 (ì²«ì§¸ì£¼ì¼)</span>
            <button onclick="changeDate(1)">â€º</button>
        </div>
        <div class="stats-bar">
            <div class="stat"><div class="stat-dot present"></div><span>ì¶œì„ <strong id="present-count">0</strong></span></div>
            <div class="stat"><div class="stat-dot absent"></div><span>ê²°ì„ <strong id="absent-count">0</strong></span></div>
        </div>
    </div>
    <div class="container" id="container">
        <div class="calendar-section" id="calendarSection">
            <div class="calendar-title">ğŸ“… 2026ë…„ ë‹¬ë ¥</div>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
        <div id="prayerSummary" class="prayer-summary" style="display:none;">
            <div class="prayer-summary-header">
                <span>ğŸ™ ì†Œë§4ëª©ì¥ ê¸°ë„ë…¸íŠ¸</span>
                <button class="prayer-summary-toggle" onclick="togglePrayerSummary()">ì ‘ê¸°</button>
            </div>
            <div class="prayer-summary-content" id="prayerSummaryContent"></div>
        </div>
        <div id="membersContainer"></div>
    </div>
    <div class="bottom-nav">
        <button class="nav-btn secondary" onclick="refreshData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button class="nav-btn copy" onclick="copyAttendance()">ğŸ“‹ ì¶œì„ ì „ì²´ ë³µì‚¬í•˜ê¸°</button>
        <button class="nav-btn prayer" onclick="copyPrayerRequests()">ğŸ™ ê¸°ë„ì œëª© ì „ì²´ ë³µì‚¬í•˜ê¸°</button>
        <button class="nav-btn manage" onclick="openPasswordModal()">âš™ï¸ ì¸ì›ìˆ˜ì •</button>
        <button class="nav-btn primary" onclick="openDatePicker()">ğŸ“… ë‚ ì§œì„ íƒ</button>
    </div>
    <div class="date-picker-modal" id="datePicker">
        <div class="date-picker-content">
            <button class="close-x" onclick="closeDatePicker()">âœ•</button>
            <div class="date-picker-title">ë‚ ì§œ ì„ íƒ</div>
            <div class="date-grid" id="dateGrid"></div>
        </div>
    </div>
    <div class="password-modal" id="passwordModal">
        <div class="password-content">
            <div class="password-title">ğŸ”’ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</div>
            <input type="text" class="password-input" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            <div class="password-hint">íŒíŠ¸: ìš°ë¦¬êµíšŒëŠ” â—‹â—‹â—‹â—‹ ì…ë‹ˆë‹¤ (4ê¸€ì)</div>
            <div class="password-error" id="passwordError">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤</div>
            <button class="manage-btn primary" onclick="checkPassword()">í™•ì¸</button>
            <button class="manage-btn secondary" onclick="closePasswordModal()">ì·¨ì†Œ</button>
        </div>
    </div>
    <div class="manage-modal" id="manageModal">
        <div class="manage-content">
            <button class="close-x" onclick="closeManageModal()">âœ•</button>
            <div class="manage-title">âš™ï¸ ì¸ì› ê´€ë¦¬</div>
            <div class="manage-section">
                <div class="manage-section-title">â• ìƒˆ ë¶€ë¶€ ì¶”ê°€</div>
                <input type="text" class="manage-input" id="newName1" placeholder="ì´ë¦„ 1 (ì˜ˆ: í™ê¸¸ë™ ì„±ë„)">
                <input type="text" class="manage-input" id="newName2" placeholder="ì´ë¦„ 2 (ì˜ˆ: í™ê¸¸ìˆœ ì„±ë„)">
                <select class="manage-select" id="newRole">
                    <option value="ì˜ˆë¹„ëª©ì›">ì˜ˆë¹„ëª©ì›</option>
                    <option value="ëª©ì›">ëª©ì›</option>
                </select>
                <input type="text" class="manage-input" id="newChildren" placeholder="ìë…€ (ì˜ˆ: ê¹€ë‹¤ìœ—5ì‚´, ê¹€ì˜ˆë‚˜2ì‚´)">
                <button class="manage-btn primary" onclick="addCouple()">ë¶€ë¶€ ì¶”ê°€</button>
            </div>
            <div class="manage-section">
                <div class="manage-section-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ë¶€ë¶€ ì„ íƒ (ìˆ˜ì •/ì‚­ì œ/ì´ë™)</div>
                <div class="couple-list" id="coupleList"></div>
            </div>
            <div class="manage-section" id="editSection" style="display:none;">
                <div class="manage-section-title">âœï¸ ì •ë³´ ìˆ˜ì •</div>
                <input type="text" class="manage-input" id="editName1" placeholder="ì´ë¦„ 1">
                <input type="text" class="manage-input" id="editName2" placeholder="ì´ë¦„ 2">
                <select class="manage-select" id="editRole">
                    <option value="ì˜ˆë¹„ëª©ì›">ì˜ˆë¹„ëª©ì›</option>
                    <option value="ëª©ì›">ëª©ì›</option>
                </select>
                <input type="text" class="manage-input" id="editChildren" placeholder="ìë…€ (ì˜ˆ: ê¹€ë‹¤ìœ—5ì‚´, ê¹€ì˜ˆë‚˜2ì‚´)">
                <button class="manage-btn primary" onclick="updateCouple()">ìˆ˜ì • ì €ì¥</button>
                <button class="manage-btn danger" onclick="deleteCouple()">ğŸ—‘ï¸ ì´ ë¶€ë¶€ ì‚­ì œ</button>
            </div>
        </div>
    </div>
    <div class="toast" id="toast"></div>
    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx8fATMQEheQ5LEYH3-WZLY3np2YP4HnAD5O-lEzKXjwNgMehCrTXfCHRFBpaKHawgC/exec';
        const sundays = [
            "2/1 (ì²«ì§¸ì£¼ì¼)", "2/8 (ë‘˜ì§¸ì£¼ì¼)", "2/15 (ì…‹ì§¸ì£¼ì¼)", "2/22 (ë„·ì§¸ì£¼ì¼)",
            "3/1 (ì²«ì§¸ì£¼ì¼)", "3/8 (ë‘˜ì§¸ì£¼ì¼)", "3/15 (ì…‹ì§¸ì£¼ì¼)", "3/22 (ë„·ì§¸ì£¼ì¼)", "3/29 (ë‹¤ì„¯ì§¸ì£¼ì¼)",
            "4/5 (ì²«ì§¸ì£¼ì¼)", "4/12 (ë‘˜ì§¸ì£¼ì¼)", "4/19 (ì…‹ì§¸ì£¼ì¼)", "4/26 (ë„·ì§¸ì£¼ì¼)",
            "5/3 (ì²«ì§¸ì£¼ì¼)", "5/10 (ë‘˜ì§¸ì£¼ì¼)", "5/17 (ì…‹ì§¸ì£¼ì¼)", "5/24 (ë„·ì§¸ì£¼ì¼)", "5/31 (ë‹¤ì„¯ì§¸ì£¼ì¼)",
            "6/7 (ì²«ì§¸ì£¼ì¼)", "6/14 (ë‘˜ì§¸ì£¼ì¼)", "6/21 (ì…‹ì§¸ì£¼ì¼)", "6/28 (ë„·ì§¸ì£¼ì¼)",
            "7/5 (ì²«ì§¸ì£¼ì¼)", "7/12 (ë‘˜ì§¸ì£¼ì¼)", "7/19 (ì…‹ì§¸ì£¼ì¼)", "7/26 (ë„·ì§¸ì£¼ì¼)",
            "8/2 (ì²«ì§¸ì£¼ì¼)", "8/9 (ë‘˜ì§¸ì£¼ì¼)", "8/16 (ì…‹ì§¸ì£¼ì¼)", "8/23 (ë„·ì§¸ì£¼ì¼)", "8/30 (ë‹¤ì„¯ì§¸ì£¼ì¼)",
            "9/6 (ì²«ì§¸ì£¼ì¼)", "9/13 (ë‘˜ì§¸ì£¼ì¼)", "9/20 (ì…‹ì§¸ì£¼ì¼)", "9/27 (ë„·ì§¸ì£¼ì¼)",
            "10/4 (ì²«ì§¸ì£¼ì¼)", "10/11 (ë‘˜ì§¸ì£¼ì¼)", "10/18 (ì…‹ì§¸ì£¼ì¼)", "10/25 (ë„·ì§¸ì£¼ì¼)",
            "11/1 (ì²«ì§¸ì£¼ì¼)", "11/8 (ë‘˜ì§¸ì£¼ì¼)", "11/15 (ì…‹ì§¸ì£¼ì¼)", "11/22 (ë„·ì§¸ì£¼ì¼)", "11/29 (ë‹¤ì„¯ì§¸ì£¼ì¼)",
            "12/6 (ì²«ì§¸ì£¼ì¼)", "12/13 (ë‘˜ì§¸ì£¼ì¼)", "12/20 (ì…‹ì§¸ì£¼ì¼)", "12/27 (ë„·ì§¸ì£¼ì¼)"
        ];
        const membersData = [];
        let currentDateIndex = 0;
        let attendance = {};
        let prayerRequests = {};
        let isSaving = false;
        let selectedCoupleGroup = null;
        
        function findClosestSunday() {
            const today = new Date();
            let closestIdx = 0, minDiff = Infinity;
            sundays.forEach((dateStr, idx) => {
                const [month, day] = dateStr.split(' ')[0].split('/').map(Number);
                const sundayDate = new Date(2026, month - 1, day);
                const diff = sundayDate - today;
                if (diff >= -86400000 && diff < minDiff) { minDiff = diff; closestIdx = idx; }
            });
            return closestIdx;
        }
        currentDateIndex = findClosestSunday();
        
        function goHome() {
            document.getElementById('calendarSection').style.display = 'block';
            document.getElementById('membersContainer').innerHTML = '';
        }
        
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const holidays = {'1-1':'ì‹ ì •','2-16':'ì„¤ë‚ ì—°íœ´','2-17':'ì„¤ë‚ ','2-18':'ì„¤ë‚ ì—°íœ´','3-1':'ì‚¼ì¼ì ˆ','5-5':'ì–´ë¦°ì´ë‚ ','5-24':'ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ','6-6':'í˜„ì¶©ì¼','8-15':'ê´‘ë³µì ˆ','9-24':'ì¶”ì„ì—°íœ´','9-25':'ì¶”ì„','9-26':'ì¶”ì„ì—°íœ´','10-3':'ê°œì²œì ˆ','10-9':'í•œê¸€ë‚ ','12-25':'ì„±íƒ„ì ˆ'};
            const months = [{name:'1ì›”',month:0},{name:'2ì›”',month:1},{name:'3ì›”',month:2},{name:'4ì›”',month:3},{name:'5ì›”',month:4},{name:'6ì›”',month:5},{name:'7ì›”',month:6},{name:'8ì›”',month:7},{name:'9ì›”',month:8},{name:'10ì›”',month:9},{name:'11ì›”',month:10},{name:'12ì›”',month:11}];
            let html = '';
            months.forEach(m => {
                const firstDay = new Date(2026, m.month, 1).getDay();
                const lastDate = new Date(2026, m.month + 1, 0).getDate();
                html += '<div class="mini-calendar"><div class="mini-calendar-header">'+m.name+'</div><div class="mini-calendar-days"><div class="day-header">ì¼</div><div class="day-header">ì›”</div><div class="day-header">í™”</div><div class="day-header">ìˆ˜</div><div class="day-header">ëª©</div><div class="day-header">ê¸ˆ</div><div class="day-header">í† </div>';
                for (let i = 0; i < firstDay; i++) html += '<div class="day empty">.</div>';
                for (let d = 1; d <= lastDate; d++) {
                    const dayOfWeek = (firstDay + d - 1) % 7;
                    const holiday = holidays[(m.month+1)+'-'+d];
                    let cls = 'day';
                    if (dayOfWeek === 0 || holiday) cls += ' sunday';
                    else if (dayOfWeek === 6) cls += ' saturday';
                    html += '<div class="'+cls+'">'+(holiday?'<span class="holiday-dot"></span>':'')+d+'</div>';
                }
                html += '</div></div>';
            });
            calendarGrid.innerHTML = html;
        }
        
        function startApp() { document.getElementById('welcomeScreen').classList.add('hidden'); openDatePicker(); }
        async function init() { generateCalendar(); updateDateDisplay(); renderDatePicker(); await loadFromSheet(); hideLoading(); }
        function showLoading(text='ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...') { document.getElementById('loadingText').textContent = text; document.getElementById('loadingOverlay').classList.remove('hidden'); }
        function hideLoading() { document.getElementById('loadingOverlay').classList.add('hidden'); }
        function setSyncStatus(status, message) { const el = document.getElementById('syncStatus'); el.className = 'sync-status ' + status; el.textContent = message; }
        
        async function loadFromSheet() {
            try {
                setSyncStatus('syncing', 'â³ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
                const response = await fetch(SCRIPT_URL);
                const result = await response.json();
                attendance = {}; prayerRequests = {};
                if (result.members && result.members.length > 0) buildMembersData(result.members);
                if (result.attendance) {
                    result.attendance.forEach(row => {
                        sundays.forEach(date => {
                            const dateOnly = date.split(' ')[0];
                            if (row[dateOnly]) {
                                const status = row[dateOnly] === 'â—‹' ? 'present' : (row[dateOnly] === 'âœ•' ? 'absent' : '');
                                if (status) attendance[date+'_'+row.name] = status;
                            }
                        });
                    });
                }
                if (result.prayers) {
                    Object.keys(result.prayers).forEach(key => {
                        const [dateOnly, ...familyParts] = key.split('_');
                        const family = familyParts.join('_');
                        const matchingDate = sundays.find(s => s.split(' ')[0] === dateOnly);
                        if (matchingDate) prayerRequests[matchingDate+'_'+family] = result.prayers[key];
                    });
                }
                renderMembers(); updateStats(); renderPrayerSummary();
                setSyncStatus('synced', 'âœ“ Google Sheets ì—°ë™ë¨');
            } catch (error) { console.error(error); setSyncStatus('error', 'âš  ì—°ê²° ì˜¤ë¥˜'); showToast('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨'); }
        }
        
        function buildMembersData(members) {
            membersData.length = 0;
            const roleOrder = ["ëª©ì", "ë¶€ëª©ì", "ì„¬ê¹€ì´", "ëª©ì›", "ì˜ˆë¹„ëª©ì›"];
            const roleGroups = {};
            members.forEach(m => {
                if (!roleGroups[m.role]) roleGroups[m.role] = {};
                if (!roleGroups[m.role][m.coupleGroup]) roleGroups[m.role][m.coupleGroup] = {names:[], children:''};
                roleGroups[m.role][m.coupleGroup].names.push(m.name);
                if (m.children) roleGroups[m.role][m.coupleGroup].children = m.children;
            });
            roleOrder.forEach(role => {
                if (roleGroups[role]) {
                    const couples = [];
                    Object.keys(roleGroups[role]).sort((a,b)=>a-b).forEach(g => {
                        couples.push({names:roleGroups[role][g].names, children:roleGroups[role][g].children, coupleGroup:parseInt(g)});
                    });
                    membersData.push({role, couples});
                }
            });
        }
        
        async function saveToSheet(date, name, status) {
            try {
                setSyncStatus('syncing', 'â³ ì €ì¥ ì¤‘...');
                await fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'save', date:date.split(' ')[0], name, status})});
                setSyncStatus('synced', 'âœ“ ì €ì¥ë¨');
            } catch (e) { setSyncStatus('error', 'âš  ì €ì¥ ì˜¤ë¥˜'); }
        }
        function renderMembers() {
            const container = document.getElementById('membersContainer');
            container.innerHTML = '';
            membersData.forEach(section => {
                const sectionEl = document.createElement('div');
                sectionEl.className = 'role-section';
                let membersHtml = '';
                section.couples.forEach((couple, coupleIdx) => {
                    const coupleKey = couple.names.join('-');
                    const currentDate = sundays[currentDateIndex];
                    const prayer = prayerRequests[currentDate+'_'+coupleKey] || '';
                    membersHtml += '<div class="couple-group">';
                    couple.names.forEach(name => {
                        const status = attendance[currentDate+'_'+name] || '';
                        membersHtml += '<div class="member-row"><div class="member-name">'+name+'</div><div class="attendance-toggle"><button class="toggle-btn '+(status==='present'?'present':'')+'" onclick="setAttendance(\''+name+'\',\'present\')">â—‹</button><button class="toggle-btn '+(status==='absent'?'absent':'')+'" onclick="setAttendance(\''+name+'\',\'absent\')">âœ•</button></div></div>';
                    });
                    if (couple.children) membersHtml += '<div class="children-info">ğŸ‘¶ '+couple.children+'</div>';
                    membersHtml += '<div class="prayer-section"><div class="prayer-label">ğŸ™ ê¸°ë„ì œëª©</div><div class="prayer-input-wrap"><input type="text" class="prayer-input" id="prayer_'+section.role+'_'+coupleIdx+'" placeholder="ê¸°ë„ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"><button class="prayer-save-btn" onclick="savePrayer(\''+coupleKey+'\',\''+section.role+'_'+coupleIdx+'\')">ì €ì¥</button></div>';
                    if (prayer) membersHtml += '<div class="saved-prayer"><div class="saved-prayer-text">'+prayer+'</div><div class="saved-prayer-actions"><button class="prayer-edit-btn" onclick="editPrayer(\''+coupleKey+'\',\''+section.role+'_'+coupleIdx+'\')">ìˆ˜ì •</button><button class="prayer-delete-btn" onclick="deletePrayer(\''+coupleKey+'\',\''+section.role+'_'+coupleIdx+'\')">ì‚­ì œ</button></div></div>';
                    membersHtml += '</div></div>';
                });
                sectionEl.innerHTML = '<div class="role-header">'+section.role+'</div><div class="members-list">'+membersHtml+'</div>';
                container.appendChild(sectionEl);
            });
        }
        
        async function setAttendance(name, status) {
            if (isSaving) return;
            const currentDate = sundays[currentDateIndex];
            const key = currentDate+'_'+name;
            if (attendance[key] === status) { delete attendance[key]; status = ''; }
            else attendance[key] = status;
            renderMembers(); updateStats();
            isSaving = true; await saveToSheet(currentDate, name, status); isSaving = false;
        }
        
        function updateStats() {
            const currentDate = sundays[currentDateIndex];
            let present = 0, absent = 0;
            Object.entries(attendance).forEach(([key, value]) => {
                if (key.startsWith(currentDate + '_')) {
                    if (value === 'present') present++;
                    if (value === 'absent') absent++;
                }
            });
            document.getElementById('present-count').textContent = present;
            document.getElementById('absent-count').textContent = absent;
        }
        
        function updateDateDisplay() { document.querySelector('.current-date').textContent = sundays[currentDateIndex]; }
        async function changeDate(delta) { await saveAllPrayers(); currentDateIndex = Math.max(0, Math.min(sundays.length-1, currentDateIndex+delta)); updateDateDisplay(); document.getElementById('calendarSection').style.display='none'; renderMembers(); updateStats(); renderPrayerSummary(); }
        function hasDataForDate(date) { for (const key of Object.keys(attendance)) if (key.startsWith(date+'_')) return true; return false; }
        
        function renderDatePicker() {
            const grid = document.getElementById('dateGrid');
            const months = {};
            sundays.forEach((date, idx) => {
                const [month, day] = date.split(' ')[0].split('/');
                if (!months[month]) months[month] = [];
                months[month].push({date, idx, day});
            });
            let html = '';
            Object.keys(months).forEach(month => {
                html += '<div class="month-section"><div class="month-header">'+month+'ì›”</div><div class="month-dates">';
                months[month].forEach(item => {
                    const weekPart = item.date.match(/\((.+)\)/)[1].replace('ì£¼ì¼','');
                    const hasData = hasDataForDate(item.date);
                    html += '<div class="date-item '+(item.idx===currentDateIndex?'selected':'')+' '+(hasData?'has-data':'')+'" onclick="selectDate('+item.idx+')">'+(hasData?'<span class="check-mark">âœ“</span>':'')+'<div class="week">'+weekPart+'</div><div class="day">'+item.day+'ì¼</div></div>';
                });
                html += '</div></div>';
            });
            grid.innerHTML = html;
        }
        
        function openDatePicker() { renderDatePicker(); document.getElementById('datePicker').classList.add('show'); }
        function closeDatePicker() { document.getElementById('datePicker').classList.remove('show'); }
        async function selectDate(idx) { await saveAllPrayers(); currentDateIndex = idx; updateDateDisplay(); document.getElementById('calendarSection').style.display='none'; renderMembers(); updateStats(); renderPrayerSummary(); closeDatePicker(); }
        async function refreshData() { showLoading('ìƒˆë¡œê³ ì¹¨ ì¤‘...'); await loadFromSheet(); hideLoading(); showToast('ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ âœ“'); }
        
        async function savePrayer(coupleKey, inputId) {
            const input = document.getElementById('prayer_'+inputId);
            const prayer = input.value.trim();
            const currentDate = sundays[currentDateIndex];
            const prayerKey = currentDate+'_'+coupleKey;
            if (prayer) prayerRequests[prayerKey] = prayer; else delete prayerRequests[prayerKey];
            try {
                setSyncStatus('syncing', 'â³ ì €ì¥ ì¤‘...');
                await fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'savePrayer', date:currentDate.split(' ')[0], family:coupleKey, prayer})});
                setSyncStatus('synced', 'âœ“ ì €ì¥ë¨'); showToast('ê¸°ë„ì œëª© ì €ì¥ ì™„ë£Œ âœ“');
                input.value = ''; renderMembers(); renderPrayerSummary();
            } catch (e) { setSyncStatus('error', 'âš  ì €ì¥ ì˜¤ë¥˜'); showToast('ì €ì¥ ì‹¤íŒ¨'); }
        }
        
        async function saveAllPrayers() {
            const currentDate = sundays[currentDateIndex];
            const dateOnly = currentDate.split(' ')[0];
            for (const section of membersData) {
                for (let i = 0; i < section.couples.length; i++) {
                    const couple = section.couples[i];
                    const coupleKey = couple.names.join('-');
                    const input = document.getElementById('prayer_'+section.role+'_'+i);
                    if (input && input.value.trim()) {
                        const prayer = input.value.trim();
                        const prayerKey = currentDate+'_'+coupleKey;
                        if (prayerRequests[prayerKey] !== prayer) {
                            prayerRequests[prayerKey] = prayer;
                            try { await fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'savePrayer', date:dateOnly, family:coupleKey, prayer})}); } catch(e){}
                        }
                    }
                }
            }
            renderMembers(); renderPrayerSummary();
        }
        
        function editPrayer(coupleKey, inputId) { const prayer = prayerRequests[sundays[currentDateIndex]+'_'+coupleKey] || ''; document.getElementById('prayer_'+inputId).value = prayer; document.getElementById('prayer_'+inputId).focus(); }
        async function deletePrayer(coupleKey, inputId) {
            if (!confirm('ê¸°ë„ì œëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            delete prayerRequests[sundays[currentDateIndex]+'_'+coupleKey];
            try {
                setSyncStatus('syncing', 'â³ ì‚­ì œ ì¤‘...');
                await fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'savePrayer', date:sundays[currentDateIndex].split(' ')[0], family:coupleKey, prayer:''})});
                setSyncStatus('synced', 'âœ“ ì‚­ì œë¨'); showToast('ê¸°ë„ì œëª© ì‚­ì œ ì™„ë£Œ âœ“'); renderMembers(); renderPrayerSummary();
            } catch(e) { setSyncStatus('error', 'âš  ì‚­ì œ ì˜¤ë¥˜'); }
        }
        async function copyAttendance() {
            await saveAllPrayers();
            const currentDate = sundays[currentDateIndex];
            const presentLines = [];
            let totalPresent = 0;
            membersData.forEach(section => {
                section.couples.forEach(couple => {
                    const presentInCouple = [];
                    couple.names.forEach(name => {
                        if (attendance[currentDate+'_'+name] === 'present') { presentInCouple.push(name); totalPresent++; }
                    });
                    if (presentInCouple.length > 0) presentLines.push(presentInCouple.join(', '));
                });
            });
            if (totalPresent === 0) { showToast('ì¶œì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤'); return; }
            let copyText = 'ì†Œë§4 ì¶œì„\n' + presentLines.join('\n');
            navigator.clipboard.writeText(copyText).then(() => showToast('ì¶œì„ ì •ë³´ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ“')).catch(() => { const ta = document.createElement('textarea'); ta.value = copyText; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); showToast('ì¶œì„ ì •ë³´ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ“'); });
        }
        
        async function copyPrayerRequests() {
            await saveAllPrayers();
            const currentDate = sundays[currentDateIndex];
            const dateOnly = currentDate.split(' ')[0];
            let copyText = dateOnly + ' ì†Œë§4ëª©ì¥ ê¸°ë„ì œëª©\n';
            let count = 1;
            const orderedRoles = ["ëª©ì›", "ì˜ˆë¹„ëª©ì›", "ì„¬ê¹€ì´", "ë¶€ëª©ì", "ëª©ì"];
            orderedRoles.forEach(role => {
                const section = membersData.find(s => s.role === role);
                if (section) {
                    section.couples.forEach(couple => {
                        const prayer = prayerRequests[currentDate+'_'+couple.names.join('-')];
                        if (prayer) {
                            const names = couple.names.filter(n => !n.includes('(ë°°ìš°ì)')).join('-');
                            copyText += count + '. ' + names + ' ê°€ì •\n   ' + prayer + '\n';
                            count++;
                        }
                    });
                }
            });
            if (count === 1) { showToast('ê¸°ë„ì œëª©ì´ ì—†ìŠµë‹ˆë‹¤'); return; }
            navigator.clipboard.writeText(copyText).then(() => showToast('ê¸°ë„ì œëª©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ“')).catch(() => { const ta = document.createElement('textarea'); ta.value = copyText; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); showToast('ê¸°ë„ì œëª©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ“'); });
        }
        
        function showToast(message) { const toast = document.getElementById('toast'); toast.textContent = message; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 2000); }
        
        function renderPrayerSummary() {
            const currentDate = sundays[currentDateIndex];
            const summaryEl = document.getElementById('prayerSummary');
            const contentEl = document.getElementById('prayerSummaryContent');
            
            let html = '';
            let count = 0;
            const orderedRoles = ["ëª©ì›", "ì˜ˆë¹„ëª©ì›", "ì„¬ê¹€ì´", "ë¶€ëª©ì", "ëª©ì"];
            
            orderedRoles.forEach(role => {
                const section = membersData.find(s => s.role === role);
                if (section) {
                    section.couples.forEach(couple => {
                        const coupleKey = couple.names.join('-');
                        const prayer = prayerRequests[currentDate + '_' + coupleKey];
                        if (prayer) {
                            const names = couple.names.filter(n => !n.includes('(ë°°ìš°ì)')).join(', ');
                            html += '<div class="prayer-summary-item"><div class="prayer-summary-family">' + names + ' ê°€ì •</div><div class="prayer-summary-text">' + prayer + '</div></div>';
                            count++;
                        }
                    });
                }
            });
            
            if (count > 0) {
                contentEl.innerHTML = html;
                summaryEl.style.display = 'block';
            } else {
                summaryEl.style.display = 'none';
            }
        }
        
        function togglePrayerSummary() {
            const contentEl = document.getElementById('prayerSummaryContent');
            const toggleBtn = document.querySelector('.prayer-summary-toggle');
            if (contentEl.classList.contains('collapsed')) {
                contentEl.classList.remove('collapsed');
                toggleBtn.textContent = 'ì ‘ê¸°';
            } else {
                contentEl.classList.add('collapsed');
                toggleBtn.textContent = 'í¼ì¹˜ê¸°';
            }
        }
        
        function openPasswordModal() { document.getElementById('passwordInput').value = ''; document.getElementById('passwordError').classList.remove('show'); document.getElementById('passwordModal').classList.add('show'); document.getElementById('passwordInput').focus(); }
        function closePasswordModal() { document.getElementById('passwordModal').classList.remove('show'); }
        function checkPassword() { if (document.getElementById('passwordInput').value === 'ë™ì•ˆêµíšŒ') { closePasswordModal(); openManageModal(); } else document.getElementById('passwordError').classList.add('show'); }
        
        function openManageModal() {
            selectedCoupleGroup = null;
            document.getElementById('editSection').style.display = 'none';
            document.getElementById('newName1').value = '';
            document.getElementById('newName2').value = '';
            document.getElementById('newRole').value = 'ì˜ˆë¹„ëª©ì›';
            document.getElementById('newChildren').value = '';
            renderCoupleList();
            document.getElementById('manageModal').classList.add('show');
        }
        function closeManageModal() { document.getElementById('manageModal').classList.remove('show'); }
        
        function renderCoupleList() {
            let html = '';
            membersData.forEach(section => {
                section.couples.forEach(couple => {
                    const isSelected = selectedCoupleGroup === couple.coupleGroup;
                    html += '<div class="couple-item '+(isSelected?'selected':'')+'" onclick="selectCouple('+couple.coupleGroup+',\''+couple.names.join(',')+'\',\''+section.role+'\',\''+( couple.children||'').replace(/'/g, "\\'")+'\')"><div><div class="couple-item-name">'+couple.names.join(', ')+'</div>'+(couple.children?'<div class="couple-item-role">ğŸ‘¶ '+couple.children+'</div>':'')+'</div><div class="couple-item-role">'+section.role+'</div></div>';
                });
            });
            document.getElementById('coupleList').innerHTML = html;
        }
        
        function selectCouple(coupleGroup, namesStr, role, children) {
            selectedCoupleGroup = coupleGroup;
            const names = namesStr.split(',');
            document.getElementById('editName1').value = names[0] || '';
            document.getElementById('editName2').value = names[1] || '';
            document.getElementById('editRole').value = role;
            document.getElementById('editChildren').value = children;
            document.getElementById('editSection').style.display = 'block';
            renderCoupleList();
        }
        
        async function addCouple() {
            const name1 = document.getElementById('newName1').value.trim();
            const name2 = document.getElementById('newName2').value.trim();
            const role = document.getElementById('newRole').value;
            const children = document.getElementById('newChildren').value.trim();
            if (!name1 || !name2) { showToast('ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
            showLoading('ì¶”ê°€ ì¤‘...');
            try {
                await fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'addCouple', name1, name2, role, children})});
                await loadFromSheet(); hideLoading(); showToast('ë¶€ë¶€ ì¶”ê°€ ì™„ë£Œ âœ“');
                document.getElementById('newName1').value = '';
                document.getElementById('newName2').value = '';
                document.getElementById('newChildren').value = '';
                renderCoupleList();
            } catch(e) { hideLoading(); showToast('ì¶”ê°€ ì‹¤íŒ¨'); }
        }
        
        async function updateCouple() {
            if (!selectedCoupleGroup) { showToast('ë¶€ë¶€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
            const name1 = document.getElementById('editName1').value.trim();
            const name2 = document.getElementById('editName2').value.trim();
            const role = document.getElementById('editRole').value;
            const children = document.getElementById('editChildren').value.trim();
            if (!name1 || !name2) { showToast('ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
            showLoading('ìˆ˜ì • ì¤‘...');
            try {
                let oldNames = [], oldRole = '';
                membersData.forEach(s => s.couples.forEach(c => { if (c.coupleGroup === selectedCoupleGroup) { oldNames = c.names; oldRole = s.role; } }));
                const oldFamily = oldNames.join('-'), newFamily = name1+'-'+name2;
                await fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'updateMember', oldName:oldNames[0], newName:name1, role, children, oldFamily, newFamily})});
                if (oldNames[1]) await fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'updateMember', oldName:oldNames[1], newName:name2, role, children:''})});
                await loadFromSheet(); hideLoading(); showToast('ìˆ˜ì • ì™„ë£Œ âœ“'); renderCoupleList();
            } catch(e) { hideLoading(); showToast('ìˆ˜ì • ì‹¤íŒ¨'); }
        }
        
        async function deleteCouple() {
            if (!selectedCoupleGroup) { showToast('ë¶€ë¶€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì¶œì„ ê¸°ë¡ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) return;
            showLoading('ì‚­ì œ ì¤‘...');
            try {
                let familyName = '';
                membersData.forEach(s => s.couples.forEach(c => { if (c.coupleGroup === selectedCoupleGroup) familyName = c.names.join('-'); }));
                await fetch(SCRIPT_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action:'deleteCouple', coupleGroup:selectedCoupleGroup, familyName})});
                await loadFromSheet(); hideLoading(); showToast('ì‚­ì œ ì™„ë£Œ âœ“');
                selectedCoupleGroup = null;
                document.getElementById('editSection').style.display = 'none';
                renderCoupleList();
            } catch(e) { hideLoading(); showToast('ì‚­ì œ ì‹¤íŒ¨'); }
        }
        
        document.getElementById('passwordInput').addEventListener('keypress', e => { if (e.key === 'Enter') checkPassword(); });
        init();
    </script>
</body>
</html>
